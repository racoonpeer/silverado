var objCheckout=new CCheckout(),Checkout=objCheckout.init();$(function(){Checkout.initialize()});function CCheckout(){var Checkout={form:null,wizard:null,container:null,construct:function(){var self=this;self.form=$("#orderForm");self.container=$("#wizard")},initialize:function(){var self=this;self.construct();self.setUpWizard();self.setUpFields()},setUpWizard:function(){var self=this;self.wizard=self.container.steps({headerTag:"h3",bodyTag:"fieldset",transitionEffect:"slide",enablePagination:!0,enableFinishButton:!0,preloadContent:!0,stepsOrientation:$.fn.steps.stepsOrientation.vertical,onFinished:function(){self.form.submit()},onStepChanging:function(event,currentIndex,newIndex){if(currentIndex>newIndex)return!0;if(currentIndex<newIndex){self.form.find(".error").removeClass("error")}self.form.validate().settings.ignore=":disabled,:hidden";return self.form.valid()},labels:{cancel:"Отмена",current:"current step:",pagination:"Pagination",finish:"Оформить заказ",next:"Далее",previous:"Назад",loading:"Подождите ..."},onFinishing:function(event,currentIndex){self.form.validate().settings.ignore=":disabled,:hidden";return self.form.valid()}});$.validator.addMethod("ukrPhone",function(value,element){return this.optional(element)||/^\+38([0-9\s]{14})$/.test(value)},'Please enter a valid phone number');self.form.validate({errorPlacement:function(error,element){element.addClass("error")},rules:{firstname:{required:!0},surname:{required:!0},phone:{required:!0,ukrPhone:!0},email:{required:!0,email:!0},city:{required:!0,},address:{required:!0,},ext_surname:{required:!0,},ext_firstname:{required:!0,}}})},setUpFields:function(){var self=this;self.form.find('#city').select2({placeholder:'Город',ajax:{url:window.location.href,dataType:'json',data:function(params){return{term:params.term,task:'getCities'}},processResults:function(json){return{results:json.items}}}});self.form.find('#address').select2({placeholder:'Адрес',disabled:!0});self.setUpAddress();self.setUpRecepient(!0);self.form.find("input[name=\"phone\"]").inputmask({mask:"+38 999 999 99 99",greedy:!1,definitions:{'*':{validator:"[0-9]",cardinality:1,casing:"lower"}}});self.form.on('change blur keyup',"input, textarea, select",function(){var iName=$(this).attr("name"),iType=$(this).attr("type"),iVal=$(this).val(),iID=$(this).attr("id"),iTarget=self.form.find("[data-source=\""+iName+"\"]"),iToggle=self.form.find("[data-toggle-id=\""+iID+"\"]"),stage=$(this).closest("fieldset");if(iTarget.length)iTarget.text(iVal);if(iToggle.length){iToggle.siblings("[data-toggle-id]").addClass("hidden");iToggle.removeClass("hidden")}
        if(iName=="city")self.setUpAddress()})},setUpAddress:function(){var self=this,inputCity=self.form.find("#city"),inputAddress=self.form.find("#address"),cityName=inputCity.val();if(typeof cityName!="undefined"){$.ajax({url:window.location.href,dataType:"json",data:{term:cityName,task:'getAddress'},success:function(json){if(json.items&&json.items.length){$.map(json.items,function(item){var opt=new Option(item.text,item.text,!1,!1);inputAddress.append(opt)});inputAddress.prop("disabled",!1).trigger('change')}},beforeSend:function(){inputAddress.prop("disabled",!0).html("")}})}},setUpRecepient:function(initial){var self=this,cb=self.form.find("#recepient"),div=cb.closest(".f-row").next(".f-row"),fields=div.find("input");if(cb.is(":checked")){fields.prop("disabled",!1).addClass("required");div.removeClass("hidden")}else{fields.prop("disabled",!0).removeClass("required");div.addClass("hidden")}
        initial=initial||!1;if(initial){self.form.find("#recepient").on("change",function(){self.setUpRecepient()})}}};this.init=function(){return Checkout}}